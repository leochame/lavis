# ====================================
# Lavis - macOS AI Agent Configuration
# ====================================

spring.application.name=lavis

# Server
server.port=18765

# ====================================
# SQLite Database Configuration
# ====================================
spring.datasource.url=jdbc:sqlite:${user.home}/.lavis/data/lavis.db
spring.datasource.driver-class-name=org.sqlite.JDBC
spring.datasource.username=
spring.datasource.password=

# JPA Configuration
spring.jpa.database-platform=org.hibernate.community.dialect.SQLiteDialect
spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=false

# Flyway Configuration
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration
spring.flyway.baseline-on-migrate=true

# SQLite Specific Configuration
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true

app.llm.default-model=fast-model
app.llm.default-stt-model=whisper
app.llm.default-tts-model=tts


# 快模型（Fast Model）- 用于快速响应的 LLM
app.llm.models.fast-model.provider=OPENAI
app.llm.models.fast-model.base-url=https://api.aifuwu.icu/v1
app.llm.models.fast-model.api-key=sk-eItWeEDa21Qx7eQfy9fhNocrPM4pH4rvT7TaSXLwuNw2KEA3
app.llm.models.fast-model.model-name=gemini-3-flash-preview
app.llm.models.fast-model.temperature=0.4
app.llm.models.fast-model.timeout-seconds=180
app.llm.models.fast-model.max-retries=3

# ====================================
# Voice: STT (Speech-to-Text) - Gemini-flash STT
# ====================================
# Using Gemini generateContent API with inlineData base64 audio upload
# Supports: audio/webm, audio/wav, audio/mpeg, audio/mp4, etc.
# Docs: https://ai.google.dev/gemini-api/docs/audio
# Set environment variable WHISPER_API_KEY or directly fill in the API Key
app.llm.models.whisper.type=STT
app.llm.models.whisper.provider=GEMINI
app.llm.models.whisper.base-url=https://api.aifuwu.icu/v1
app.llm.models.whisper.api-key=${WHISPER_API_KEY:sk-eItWeEDa21Qx7eQfy9fhNocrPM4pH4rvT7TaSXLwuNw2KEA3}
app.llm.models.whisper.model-name=gemini-3-flash-preview
app.llm.models.whisper.timeout-seconds=180

# ====================================
# Voice: TTS (Text-to-Speech) - Qwen TTS
# ====================================
# Using Alibaba Cloud DashScope native SDK (qwen3-tts-flash)
# Supported voices: Cherry, Dylan, Jada, Sunny
app.llm.models.tts.type=TTS
app.llm.models.tts.provider=DASHSCOPE
app.llm.models.tts.api-key=${TTS_API_KEY:sk-21ffaa31cbef417aab95112551b79825}
app.llm.models.tts.model-name=qwen3-tts-flash
app.llm.models.tts.voice=Cherry
app.llm.models.tts.format=wav
app.llm.models.tts.timeout-seconds=180


# ====================================
# Agent Configuration
# ====================================
# Model alias used by the Agent (corresponds to the key in app.llm.models.*)
agent.model.alias=fast-model
# Retry configuration
agent.retry.max=3
agent.retry.delay.ms=2000
agent.max.tool.iterations=30

# Model alias for executor (leave empty to use agent.model.alias)
# executor.model.alias=executor

# [Critical] Wait time (in milliseconds) after tool execution for UI response
# This time must be long enough to allow screen changes to complete before taking screenshots
# Recommended at least 1000ms to wait for animations and network requests to complete
agent.tool.wait.ms=1000

# ====================================
# Screenshot Configuration
# ====================================
# Screenshot compression width (reducing can decrease token consumption)
screenshot.target.width=1280
# Screenshot quality (0.0-1.0)
screenshot.quality=1.0

# ====================================
# Context Engineering: Perceptual Deduplication
# ====================================
# Enable perceptual deduplication to reduce redundant screenshots
lavis.perception.dedup.enabled=true
# Hamming distance threshold (0-64, lower = stricter)
# 10 = ~15% change tolerance, good for most UI scenarios
lavis.perception.dedup.threshold=10

# ====================================
# Context Engineering: Cold Storage
# ====================================
# Path for archived images
lavis.storage.cold-path=${user.home}/.lavis/cold-storage
# Retention period for cold storage (days)
lavis.storage.retention-days=30

# ====================================
# Context Engineering: Web Search
# ====================================
# Search provider: duckduckgo (free) or tavily (requires API key)
lavis.search.provider=duckduckgo
# Tavily API key (optional, get from https://tavily.com)
lavis.search.tavily.api-key=${TAVILY_API_KEY:}
# Search timeout in seconds
lavis.search.timeout-seconds=30
# Maximum results per search
lavis.search.max-results=5

# ====================================
# Logging
# ====================================
logging.level.com.lavis=INFO
logging.level.dev.langchain4j=WARN
logging.pattern.console=%d{HH:mm:ss} %clr(%-5level) %cyan(%logger{20}) - %msg%n

# ====================================
# JavaFX
# ====================================
spring.main.allow-bean-definition-overriding=true

# ====================================
# Gemini Computer Use Configuration
# (https://ai.google.dev/gemini-api/docs/computer-use)
# ====================================
# Computer Use dedicated model
#gemini.computer.use.model=gemini-2.5-computer-use-preview-10-2025
# Maximum iteration count
gemini.computer.use.max.iterations=30
# Keep the last N rounds of screenshots (reduce token consumption)
gemini.computer.use.max.screenshots=3
# Default browser
computer.use.default.browser=Google Chrome
# Delay after action (in milliseconds)
computer.use.action.delay.ms=300

# ====================================
# Scheduler Configuration
# ====================================
scheduler.task.timeout.seconds=300
scheduler.thread.pool.size=10
scheduler.history.retention.days=90

# ====================================
# Skills Configuration
# ====================================
skills.directory=${user.home}/.lavis/skills
skills.hot-reload.enabled=true
skills.hot-reload.interval.ms=5000

# ====================================
# Unified ReAct Decision Loop Configuration
# ====================================
# Maximum iterations before timeout
lavis.orchestrator.max-iterations=50
# Maximum consecutive failures before abort
lavis.orchestrator.max-consecutive-failures=5
# Delay between actions in batch execution (ms)
lavis.executor.action-delay-ms=100
# Wait time after boundary actions (click/enter/scroll) (ms)
lavis.executor.boundary-wait-ms=500
