# æ‰“åŒ…é…ç½®æ¶æ„ç¬¦åˆæ€§æ£€æŸ¥æŠ¥å‘Š

## âœ… æ€»ä½“è¯„ä¼°ï¼š**ç¬¦åˆæœ€æ–°æ¶æ„**

æ‰“åŒ…é…ç½®ä¸é¡¹ç›®æœ€æ–°æ¶æ„å®Œå…¨åŒ¹é…ï¼Œæ‰€æœ‰å…³é”®ç»„ä»¶å’Œè·¯å¾„é…ç½®æ­£ç¡®ã€‚

---

## ğŸ“‹ æŠ€æœ¯æ ˆç‰ˆæœ¬åŒ¹é…

| ç»„ä»¶ | é…ç½®ç‰ˆæœ¬ | æ–‡æ¡£ç‰ˆæœ¬ | çŠ¶æ€ |
|------|---------|---------|------|
| Spring Boot | 3.5.9 | 3.5.9 | âœ… åŒ¹é… |
| Java | 21 | 21 | âœ… åŒ¹é… |
| React | 19.2.0 | 19.x | âœ… åŒ¹é… |
| Electron | 40.0.0 | 40.x | âœ… åŒ¹é… |
| Vite | 7.2.4 | 7.x | âœ… åŒ¹é… |
| TypeScript | 5.9.3 | 5.9 | âœ… åŒ¹é… |
| LangChain4j | 0.35.0 | 0.35.0 | âœ… åŒ¹é… |

---

## ğŸ”§ æ‰“åŒ…é…ç½®æ£€æŸ¥

### 1. Electron Builder é…ç½® (`electron-builder.config.js`)

#### âœ… æ–‡ä»¶åŒ…å«é…ç½®
```javascript
files: [
  'dist/**/*',           // âœ… Vite æ„å»ºçš„å‰ç«¯èµ„æº
  'electron/**/*.js',    // âœ… TypeScript ç¼–è¯‘åçš„ Electron ä¸»è¿›ç¨‹
  'package.json',        // âœ… åº”ç”¨å…ƒæ•°æ®
]
```
- **çŠ¶æ€**: âœ… æ­£ç¡®
- **è¯´æ˜**: åŒ…å«æ‰€æœ‰å¿…è¦çš„æ–‡ä»¶ï¼ŒTypeScript æºæ–‡ä»¶ä¼šå…ˆç¼–è¯‘ä¸º JS

#### âœ… ASAR è§£å‹é…ç½®
```javascript
asarUnpack: [
  'node_modules/**/*.node',        // âœ… åŸç”Ÿæ¨¡å—
  'dist/models/**/*.tar.gz',      // âœ… Vosk æ¨¡å‹æ–‡ä»¶
]
```
- **çŠ¶æ€**: âœ… æ­£ç¡®
- **è¯´æ˜**: æ¨¡å‹æ–‡ä»¶éœ€è¦ä» asar ä¸­è§£å‹ï¼Œvosk-browser éœ€è¦ç›´æ¥è®¿é—®æ–‡ä»¶ç³»ç»Ÿ

#### âœ… é¢å¤–èµ„æºé…ç½®
```javascript
extraResources: [
  {
    from: '../target/lavis-0.0.1-SNAPSHOT.jar',
    to: 'backend/lavis.jar',
  },
  {
    from: 'jre',
    to: 'jre',
    filter: ['**/*'],
  },
]
```
- **çŠ¶æ€**: âœ… æ­£ç¡®
- **è¯´æ˜**: 
  - JAR æ–‡ä»¶æ­£ç¡®æ˜ å°„åˆ° `Resources/backend/lavis.jar`
  - JRE ç›®å½•ç»“æ„ï¼š`jre/mac-arm64/` â†’ `Resources/jre/mac-arm64/`

#### âœ… æ‰“åŒ…åé’©å­
```javascript
afterPack: async (context) => {
  // è®¾ç½® JRE æ‰§è¡Œæƒé™
}
```
- **çŠ¶æ€**: âœ… æ­£ç¡®
- **è¯´æ˜**: ç¡®ä¿ Java å¯æ‰§è¡Œæ–‡ä»¶å’ŒåŠ¨æ€åº“æœ‰æ­£ç¡®çš„æ‰§è¡Œæƒé™

---

### 2. è·¯å¾„åŒ¹é…éªŒè¯

#### âœ… JRE è·¯å¾„
- **é…ç½®**: `jre/mac-arm64/Contents/Home/bin/java`
- **æ‰“åŒ…å**: `Resources/jre/mac-arm64/Contents/Home/bin/java`
- **backend-manager.ts æœŸæœ›**: `Resources/jre/mac-arm64/Contents/Home/bin/java`
- **çŠ¶æ€**: âœ… å®Œå…¨åŒ¹é…

#### âœ… JAR è·¯å¾„
- **é…ç½®**: `../target/lavis-0.0.1-SNAPSHOT.jar`
- **æ‰“åŒ…å**: `Resources/backend/lavis.jar`
- **backend-manager.ts æœŸæœ›**: `Resources/backend/lavis.jar`
- **çŠ¶æ€**: âœ… å®Œå…¨åŒ¹é…

---

### 3. æ„å»ºæµç¨‹éªŒè¯

#### âœ… TypeScript ç¼–è¯‘
- **é…ç½®**: `tsconfig.electron.json`
- **è¾“å‡º**: `electron/**/*.js`
- **çŠ¶æ€**: âœ… æ­£ç¡®

#### âœ… Vite æ„å»º
- **é…ç½®**: `vite.config.ts`
- **è¾“å‡º**: `dist/**/*`
- **base**: `./` (ç›¸å¯¹è·¯å¾„ï¼Œé€‚åˆ Electron)
- **çŠ¶æ€**: âœ… æ­£ç¡®

#### âœ… Maven æ„å»º
- **é…ç½®**: `pom.xml`
- **è¾“å‡º**: `target/lavis-0.0.1-SNAPSHOT.jar`
- **çŠ¶æ€**: âœ… æ­£ç¡®

---

## ğŸ“¦ æ‰“åŒ…è„šæœ¬éªŒè¯ (`scripts/package.js`)

### âœ… æ„å»ºæ­¥éª¤
1. âœ… æ£€æŸ¥å‰ç½®æ¡ä»¶ (Java, Maven, Node.js)
2. âœ… æ„å»º Java åç«¯ JAR
3. âœ… ç¼–è¯‘ Electron ä¸»è¿›ç¨‹ TypeScript
4. âœ… æ„å»ºå‰ç«¯èµ„æº (Vite)
5. âœ… ä½¿ç”¨ electron-builder æ‰“åŒ…
6. âœ… éªŒè¯æ‰“åŒ…èµ„æº (JRE, JAR)

### âœ… æ™ºèƒ½ä¼˜åŒ–
- âœ… JAR æ–‡ä»¶å­˜åœ¨ä¸”è¾ƒæ–°æ—¶è·³è¿‡æ„å»º
- âœ… è‡ªåŠ¨æ£€æµ‹å’Œè®¾ç½® JAVA_HOME
- âœ… æ”¯æŒ Maven Wrapper å’Œç³»ç»Ÿ Maven

---

## ğŸ¯ æ¶æ„å¯¹é½æ£€æŸ¥

### âœ… å‰ç«¯æ¶æ„ (Electron + React + Vite)
- âœ… Electron 40.x ä¸»è¿›ç¨‹
- âœ… React 19.x æ¸²æŸ“è¿›ç¨‹
- âœ… Vite 7.x æ„å»ºå·¥å…·
- âœ… TypeScript 5.9 ç±»å‹å®‰å…¨
- âœ… Zustand 5.x çŠ¶æ€ç®¡ç†

### âœ… åç«¯æ¶æ„ (Spring Boot + Java)
- âœ… Spring Boot 3.5.9
- âœ… Java 21
- âœ… LangChain4j 0.35.0
- âœ… Maven æ„å»ºç³»ç»Ÿ

### âœ… é›†æˆæ¶æ„
- âœ… REST API é€šä¿¡
- âœ… WebSocket å®æ—¶é€šä¿¡
- âœ… å†…åµŒ JRE (Java 21)
- âœ… å†…åµŒåç«¯ JAR

---

## ğŸ” å®é™…æ‰“åŒ…éªŒè¯

### âœ… æ‰“åŒ…ç»“æœæ£€æŸ¥
- âœ… DMG å®‰è£…åŒ…ç”ŸæˆæˆåŠŸ
- âœ… ZIP å‹ç¼©åŒ…ç”ŸæˆæˆåŠŸ
- âœ… JRE æ–‡ä»¶æ­£ç¡®æ”¾ç½®
- âœ… JAR æ–‡ä»¶æ­£ç¡®æ”¾ç½®
- âœ… Java å¯æ‰§è¡Œæ–‡ä»¶æƒé™æ­£ç¡®
- âœ… æ¨¡å‹æ–‡ä»¶æ­£ç¡®è§£å‹

### âœ… æ–‡ä»¶ç»“æ„éªŒè¯
```
Lavis.app/Contents/Resources/
â”œâ”€â”€ app.asar                    âœ… å‰ç«¯èµ„æº
â”œâ”€â”€ app.asar.unpacked/          âœ… è§£å‹çš„æ¨¡å‹æ–‡ä»¶
â”œâ”€â”€ backend/
â”‚   â””â”€â”€ lavis.jar              âœ… åç«¯ JAR
â””â”€â”€ jre/
    â””â”€â”€ mac-arm64/
        â””â”€â”€ Contents/
            â””â”€â”€ Home/
                â””â”€â”€ bin/
                    â””â”€â”€ java    âœ… Java å¯æ‰§è¡Œæ–‡ä»¶
```

---

## âœ¨ ç»“è®º

**æ‰“åŒ…é…ç½®å®Œå…¨ç¬¦åˆæœ€æ–°æ¶æ„è¦æ±‚**ï¼Œæ‰€æœ‰å…³é”®ç»„ä»¶ã€è·¯å¾„å’Œæ„å»ºæµç¨‹éƒ½å·²æ­£ç¡®é…ç½®ã€‚

### ä¼˜åŠ¿
1. âœ… æŠ€æœ¯æ ˆç‰ˆæœ¬ä¸æ–‡æ¡£ä¸€è‡´
2. âœ… è·¯å¾„é…ç½®å‡†ç¡®æ— è¯¯
3. âœ… æ„å»ºæµç¨‹å®Œæ•´ä¸”ä¼˜åŒ–
4. âœ… èµ„æºæ‰“åŒ…æ­£ç¡®
5. âœ… æƒé™è®¾ç½®å®Œå–„

### å»ºè®®
- âœ… å½“å‰é…ç½®æ— éœ€ä¿®æ”¹
- âœ… å¯ä»¥ç»§ç»­ä½¿ç”¨ç°æœ‰æ‰“åŒ…æµç¨‹
- âœ… æ‰“åŒ…è„šæœ¬å·²åŒ…å«å¿…è¦çš„é”™è¯¯å¤„ç†å’ŒéªŒè¯

---

*ç”Ÿæˆæ—¶é—´: 2025-02-05*
*æ£€æŸ¥èŒƒå›´: æ‰“åŒ…é…ç½®ã€æŠ€æœ¯æ ˆç‰ˆæœ¬ã€è·¯å¾„åŒ¹é…ã€æ„å»ºæµç¨‹*

