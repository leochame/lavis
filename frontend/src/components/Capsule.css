/* ==========================================
   Capsule - 极简悬浮胶囊设计
   设计理念：数字精灵，低侵入性
   参考：macOS 悬浮球、Siri 动画
   ========================================== */

.capsule {
  /* 不使用 absolute 定位，让父容器的 flex 居中 */
  position: relative;

  /* 圆形形态 - 极简 */
  width: 56px;
  height: 56px;
  border-radius: 50%;

  /* 调试：使用不透明背景 */
  background: rgba(30, 30, 50, 0.95);
  backdrop-filter: blur(24px);
  -webkit-backdrop-filter: blur(24px);

  /* 更明显的边框 */
  border: 2px solid rgba(0, 212, 255, 0.3);

  cursor: grab;
  display: flex;
  align-items: center;
  justify-content: center;

  /* 平滑过渡 */
  transition:
    transform 0.2s cubic-bezier(0.25, 0.8, 0.25, 1),
    box-shadow 0.3s ease,
    border-color 0.3s ease;

  /* 更明显的阴影 */
  box-shadow:
    0 4px 20px rgba(0, 0, 0, 0.5),
    0 0 30px rgba(0, 212, 255, 0.2),
    0 0 0 1px rgba(255, 255, 255, 0.1) inset;

  z-index: 9999;

  /* 不使用系统拖拽，使用自定义 IPC 拖拽 */
  -webkit-app-region: no-drag;
  user-select: none;
  
  /* 允许子元素溢出，以便显示烟雾效果 */
  overflow: visible;
}

/* 悬停效果 - 轻微放大 + 边框高亮 */
.capsule:hover {
  transform: scale(1.08);
  border-color: rgba(255, 255, 255, 0.15);
  box-shadow:
    0 4px 24px rgba(0, 0, 0, 0.35),
    0 0 0 1px rgba(255, 255, 255, 0.1) inset;
}

/* 拖拽中 */
.capsule:active {
  cursor: grabbing;
  transform: scale(1.02);
}

/* ==========================================
   能量芯 (Core) - 核心视觉元素
   这是唯一的视觉焦点
   ========================================== */

.capsule__core {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  background: linear-gradient(135deg, #00d4ff 0%, #00a8cc 100%);
  position: relative;
  z-index: 2;

  /* 柔和发光 */
  box-shadow:
    0 0 20px rgba(0, 212, 255, 0.5),
    0 0 40px rgba(0, 212, 255, 0.2);

  /* 核心区域用于响应点击 */
  -webkit-app-region: no-drag;
  cursor: pointer;

  transition:
    transform 0.3s cubic-bezier(0.25, 0.8, 0.25, 1),
    box-shadow 0.3s ease,
    background 0.3s ease;
}

.capsule__core:hover {
  transform: scale(1.1);
}

.capsule__core:active {
  transform: scale(0.95);
}

/* ==========================================
   呼吸光晕 (Glow) - 背景光效
   ========================================== */

.capsule__glow {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 100%;
  height: 100%;
  border-radius: 50%;
  background: radial-gradient(
    circle,
    rgba(0, 212, 255, 0.15) 0%,
    transparent 70%
  );
  opacity: 0;
  transition: opacity 0.3s ease;
  pointer-events: none;
  z-index: 1;
}

.capsule:hover .capsule__glow {
  opacity: 1;
}

/* ==========================================
   状态样式 - 通过颜色传达状态
   ========================================== */

/* 待机状态 - 静谧蓝 */
.capsule--idle .capsule__core {
  background: linear-gradient(135deg, #00d4ff 0%, #00a8cc 100%);
  box-shadow:
    0 0 20px rgba(0, 212, 255, 0.5),
    0 0 40px rgba(0, 212, 255, 0.2);
}

/* 思考状态 - 紫色脉冲 */
.capsule--thinking .capsule__core {
  background: linear-gradient(135deg, #a855f7 0%, #7c3aed 100%);
  box-shadow:
    0 0 24px rgba(168, 85, 247, 0.6),
    0 0 48px rgba(168, 85, 247, 0.3);
  animation: pulse-soft 1.5s ease-in-out infinite;
}

/* 执行状态 - 绿色 */
.capsule--executing .capsule__core {
  background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
  box-shadow:
    0 0 24px rgba(34, 197, 94, 0.6),
    0 0 48px rgba(34, 197, 94, 0.3);
  animation: pulse-soft 1s ease-in-out infinite;
}

/* 错误状态 - 红色 */
.capsule--error .capsule__core {
  background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
  box-shadow:
    0 0 24px rgba(239, 68, 68, 0.6),
    0 0 48px rgba(239, 68, 68, 0.3);
  animation: pulse-error 0.6s ease-in-out infinite;
}

/* ==========================================
   语音状态 - 特殊视觉反馈
   ========================================== */

/* 聆听状态 - 活跃橙红，Siri 风格 */
.capsule--listening {
  border-color: rgba(255, 100, 100, 0.2);
}

.capsule--listening .capsule__core {
  background: linear-gradient(135deg, #ff6b6b 0%, #ff8e53 100%);
  box-shadow:
    0 0 28px rgba(255, 107, 107, 0.7),
    0 0 56px rgba(255, 142, 83, 0.4);
  animation: breathing 1.2s ease-in-out infinite;
}

.capsule--listening .capsule__glow {
  background: radial-gradient(
    circle,
    rgba(255, 107, 107, 0.2) 0%,
    transparent 70%
  );
  opacity: 1;
  animation: glow-pulse 1.2s ease-in-out infinite;
}

/* 说话状态 - 绿色波动 */
.capsule--speaking {
  border-color: rgba(34, 197, 94, 0.2);
}

.capsule--speaking .capsule__core {
  background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
  box-shadow:
    0 0 24px rgba(34, 197, 94, 0.6),
    0 0 48px rgba(34, 197, 94, 0.3);
  animation: speaking 0.8s ease-in-out infinite;
}

/* ==========================================
   呼吸动画 - 待机时的生命感
   ========================================== */

.capsule--breathing .capsule__core {
  animation: breathing-idle 3s ease-in-out infinite;
}

.capsule--breathing .capsule__glow {
  opacity: 0.5;
  animation: glow-idle 3s ease-in-out infinite;
}

/* ==========================================
   声纹波纹效果 (Ripple Effect)
   ========================================== */

.capsule__voice-rings {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 0;
}

.capsule__voice-ring {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  border-radius: 50%;
  border: 1px solid currentColor;
  opacity: 0;
  animation: ring-expand 1.8s ease-out infinite;
}

.capsule--listening .capsule__voice-ring {
  border-color: rgba(255, 107, 107, 0.4);
}

.capsule--speaking .capsule__voice-ring {
  border-color: rgba(34, 197, 94, 0.4);
}

.capsule__voice-ring:nth-child(1) { animation-delay: 0s; }
.capsule__voice-ring:nth-child(2) { animation-delay: 0.6s; }
.capsule__voice-ring:nth-child(3) { animation-delay: 1.2s; }

/* ==========================================
   动画关键帧
   ========================================== */

/* 待机呼吸 - 缓慢、平静 */
@keyframes breathing-idle {
  0%, 100% {
    transform: scale(1);
    box-shadow:
      0 0 20px rgba(0, 212, 255, 0.5),
      0 0 40px rgba(0, 212, 255, 0.2);
  }
  50% {
    transform: scale(1.08);
    box-shadow:
      0 0 28px rgba(0, 212, 255, 0.6),
      0 0 56px rgba(0, 212, 255, 0.3);
  }
}

@keyframes glow-idle {
  0%, 100% {
    opacity: 0.3;
    transform: translate(-50%, -50%) scale(1);
  }
  50% {
    opacity: 0.6;
    transform: translate(-50%, -50%) scale(1.1);
  }
}

/* 聆听呼吸 - 活跃、有节奏 */
@keyframes breathing {
  0%, 100% {
    transform: scale(0.95);
  }
  50% {
    transform: scale(1.12);
  }
}

@keyframes glow-pulse {
  0%, 100% {
    opacity: 0.6;
    transform: translate(-50%, -50%) scale(1);
  }
  50% {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1.15);
  }
}

/* 通用脉冲 */
@keyframes pulse-soft {
  0%, 100% {
    transform: scale(1);
    opacity: 1;
  }
  50% {
    transform: scale(1.06);
    opacity: 0.9;
  }
}

/* 错误脉冲 */
@keyframes pulse-error {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.6;
  }
}

/* 说话波动 */
@keyframes speaking {
  0%, 100% {
    transform: scale(1);
  }
  25% {
    transform: scale(1.04);
  }
  75% {
    transform: scale(1.04);
  }
}

/* 波纹扩散 */
@keyframes ring-expand {
  0% {
    width: 60%;
    height: 60%;
    opacity: 0.5;
  }
  100% {
    width: 200%;
    height: 200%;
    opacity: 0;
  }
}

/* ==========================================
   工作状态指示器 - 青烟和波纹效果
   当 WebSocket 连接正常且后端正在工作时显示
   ========================================== */

.capsule__working-indicator {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 200px; /* 扩大容器以容纳烟雾和波纹 */
  height: 200px;
  pointer-events: none;
  z-index: 1; /* 在 glow 之上，但在 core 之下 */
  overflow: visible; /* 确保烟雾和波纹可以超出容器 */
}

/* 青烟效果 - 从中心向上飘散 */
.capsule__smoke-ring {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: radial-gradient(circle, rgba(0, 212, 255, 0.9) 0%, rgba(0, 212, 255, 0.4) 50%, rgba(0, 212, 255, 0) 100%);
  opacity: 0;
  animation: capsule-smoke-rise 2.5s ease-out infinite;
  pointer-events: none;
}

.capsule__smoke-ring--1 {
  animation-delay: 0s;
  width: 5px;
  height: 5px;
}

.capsule__smoke-ring--2 {
  animation-delay: 0.5s;
  width: 7px;
  height: 7px;
}

.capsule__smoke-ring--3 {
  animation-delay: 1s;
  width: 9px;
  height: 9px;
}

@keyframes capsule-smoke-rise {
  0% {
    opacity: 0.9;
    transform: translate(-50%, -50%) scale(0.5);
  }
  30% {
    opacity: 0.7;
    transform: translate(-50%, -80%) scale(1);
  }
  60% {
    opacity: 0.4;
    transform: translate(-50%, -150%) scale(1.5);
  }
  100% {
    opacity: 0;
    transform: translate(-50%, -250%) scale(2.2);
  }
}

/* 波纹效果 - 从中心向外扩散 */
.capsule__ripple {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 56px;
  height: 56px;
  border-radius: 50%;
  border: 2px solid rgba(0, 212, 255, 0.5);
  opacity: 0;
  animation: capsule-ripple-expand 2s ease-out infinite;
}

.capsule__ripple--1 {
  animation-delay: 0s;
}

.capsule__ripple--2 {
  animation-delay: 1s;
}

@keyframes capsule-ripple-expand {
  0% {
    width: 56px;
    height: 56px;
    opacity: 0.8;
    transform: translate(-50%, -50%) scale(1);
  }
  100% {
    width: 120px;
    height: 120px;
    opacity: 0;
    transform: translate(-50%, -50%) scale(1);
  }
}
